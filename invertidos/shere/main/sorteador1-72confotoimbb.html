<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sorteador N√∫meros 1-72 ‚òÜ Shere</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * { -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; outline: none; }
        body { background: #000; color: #fff; font-family: 'Arial Black', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 0; margin: 0; overflow: hidden; }

        #bloqueo-seguridad { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .login-box { background: #111; padding: 30px; border: 2px solid #39ff14; border-radius: 12px; text-align: center; box-shadow: 0 0 20px #39ff14; }
        .login-box input { background: #000; border: 1px solid #333; color: #39ff14; padding: 10px; border-radius: 5px; text-align: center; font-size: 16px; margin-bottom: 15px; }
        .login-box button { background: #39ff14; color: #000; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; }

        #contenido-protegido { display: none; width: 100%; height: 100%; }

        .layout-horizontal { display: grid; grid-template-columns: 450px 1fr; width: 100vw; height: 100vh; gap: 10px; padding: 10px; box-sizing: border-box; }

        .loteria-section { display: flex; flex-direction: column; background: #0a0a0a; padding: 15px; border-radius: 12px; border: 1px solid #333; align-items: center; overflow-y: auto; box-sizing: border-box; }

        .visor-y-historial { display: flex; gap: 15px; justify-content: center; width: 100%; }
        .visor { width: 160px; height: 160px; background-color: #000; border: 5px solid #39ff14; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px rgba(57, 255, 20, 0.4); }
        .numero-grande { color: #39ff14; font-size: 70px; font-weight: 900; text-shadow: 0 0 15px #39ff14; }
        .historial-container { display: flex; flex-direction: column; width: 130px; }
        .historial { height: 180px; background: #111; border: 2px solid #333; border-radius: 10px; padding: 5px; overflow-y: auto; }
        .item-historial { display: flex; align-items: center; justify-content: center; background: #222; border-radius: 50%; border: 1px solid #39ff14; font-size: 14px; width: 35px; height: 35px; margin: 5px auto; color: #39ff14; font-weight: bold; }

        .controles { margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; width: 100%; }
        button { padding: 10px; font-size: 10px; font-weight: bold; border: none; border-radius: 6px; cursor: pointer; text-transform: uppercase; }

        .tool-box { width: 100%; background: #1a1a1a; padding: 10px; border-radius: 8px; border: 1px solid #333; margin-top: 8px; box-sizing: border-box; }
        .tool-box label { font-size: 10px; color: #39ff14; display: block; margin-bottom: 5px; }
        .input-chat { background: #000; border: 1px solid #444; color: #39ff14; padding: 8px; border-radius: 4px; font-size: 13px; text-align: center; width: 100%; box-sizing: border-box; margin-bottom: 5px; outline: none; }
        
        /* Estilo especial para el Link cuando aparece */
        #txt-link { color: #ff00ff; border-color: #ff00ff; font-weight: bold; }

        .chat-section { width: 100%; height: 100%; background: #111; border: 2px solid #39ff14; border-radius: 12px; overflow: hidden; }
        .chat-section iframe { width: 100%; height: 100%; border: none; }

        #modal-general { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:2000; justify-content:center; align-items:center; }
        .modal-contenedor-dinamico { background:#000; border:2px solid #39ff14; border-radius:10px; padding:20px; position:relative; width: 95%; max-width: 800px; }
        #captura-area { background: #000; padding: 15px; border: 1px solid #333; }
        .grid-numeros { display:grid; grid-template-columns: repeat(12, 1fr); gap: 5px; margin-top: 10px; }
        .num-bola-modal { border-radius: 50%; display: flex; align-items: center; justify-content: center; aspect-ratio: 1/1; font-weight: bold; font-size: 14px; border: 1px solid #333; color: #444; }
        .bola-salio { border-color: #ff0000; background: #ff0000; color: #fff; box-shadow: 0 0 5px #ff0000; }
        .bola-orden-neon { border-color: #39ff14; color: #39ff14; box-shadow: 0 0 8px #39ff14; }
    </style>
</head>
<body oncontextmenu="return false">

    <div id="bloqueo-seguridad">
        <div class="login-box">
            <h2>SORTEADOR (1-72)</h2>
            <input type="password" id="pass-lm" placeholder="PIN DE ACCESO">
            <br>
            <button id="btn-entrar">ENTRAR</button>
        </div>
    </div>

    <div id="contenido-protegido">
        <div class="layout-horizontal">
            <div class="loteria-section">
                <button style="background:#00bcff; color:#000; width:100%; margin-bottom:10px;" onclick="window.abrirTableroFijo()">üìä TABLERO FIJO (1-72)</button>

                <div class="visor-y-historial">
                    <div style="text-align:center;">
                        <div class="visor" id="visor"><div class="numero-grande" id="numero-visor">--</div></div>
                        <p id="contador-cartas" style="color:#ffeb3b; font-size: 11px; margin-top: 5px;">SALIERON: 0 / 72</p>
                    </div>
                    <div class="historial-container">
                        <div class="historial" id="lista-historial"></div>
                        <button style="background:#ff00ff; color:#fff; margin-top:5px;" onclick="window.abrirTableroOrden()">üìã VER ORDEN</button>
                    </div>
                </div>

                <div class="controles">
                    <button style="background:#39ff14; color:#000;" id="btn-play" onclick="window.comenzar()">‚ñ∂ Play</button>
                    <button style="background:#ffeb3b; color:#000;" id="btn-pause" onclick="window.pausar()" disabled>‚è∏ Pausa</button>
                    <button style="background:#ff0000; color:#fff;" onclick="window.reiniciar()">üîÑ Reset</button>
                    <button id="btn-audio" style="background:#555; color:#fff;" onclick="window.toggleAudio()">üîä Audio</button>
                </div>

                <div style="width:100%; margin-top:10px; text-align:center;">
                    <label style="font-size:10px; color:#aaa;">Velocidad: <span id="val-velocidad">4.0</span>s</label>
                    <input type="range" min="2" max="8" step="0.5" value="4" style="width:100%; cursor:pointer;" oninput="window.cambiarVelocidad(this.value)">
                </div>

                <div class="tool-box">
                    <label>N√öMERO ACTUAL (AUTO-COPIADO):</label>
                    <div style="display:flex; gap:5px;">
                        <input type="text" id="input-adorno" style="width:40px; background:#000; color:#39ff14; border:1px solid #333; text-align:center;" value="‚òÜ">
                        <input type="text" id="txt-numero" class="input-chat" readonly placeholder="...">
                    </div>
                </div>

                <div class="tool-box" style="border: 2px solid #ff00ff;">
                    <label style="color:#ff00ff;">LINK DE TABLERO (SUBIDA A INTERNET):</label>
                    <input type="text" id="txt-link" class="input-chat" readonly placeholder="El link aparecer√° aqu√≠">
                    <button style="background:#fff; color:#000; width:100%; font-weight: bold; height: 40px;" id="btn-gen" onclick="window.generarLinkInternet()">üåê GENERAR Y COPIAR LINK</button>
                </div>
            </div>

            <div class="chat-section">
                <iframe src="https://xat.com/embed/chat.php#id=220526680&gn=RINCONCITO_MAGICO_MUSICAL" frameborder="0" scrolling="no"></iframe>
            </div>
        </div>
    </div>

    <div id="modal-general">
        <div class="modal-contenedor-dinamico">
            <span onclick="window.cerrarModal()" style="position:absolute; top:0px; right:15px; color:#ff4444; font-size:40px; cursor:pointer;">&times;</span>
            <div id="captura-area">
                <h2 id="modal-titulo" style="color: #39ff14; text-align: center; font-size: 18px; margin: 0;">TABLERO</h2>
                <div id="modal-grid" class="grid-numeros"></div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('btn-entrar').onclick = () => {
            if(document.getElementById('pass-lm').value === "shere2026") {
                document.getElementById('bloqueo-seguridad').style.display = 'none';
                document.getElementById('contenido-protegido').style.display = 'block';
            } else { alert("PIN INCORRECTO"); }
        };

        let bombo = [], indiceActual = 0, intervalo = null, numerosSalidos = [], audioActivado = true, velocidadS = 4;

        window.prepararBombo = () => { bombo = Array.from({length: 72}, (_, i) => i + 1); bombo.sort(() => Math.random() - 0.5); }
        window.cambiarVelocidad = (val) => { velocidadS = val; document.getElementById('val-velocidad').innerText = val; if (intervalo) { window.pausar(); window.comenzar(); } }

        window.comenzar = () => {
            if (bombo.length === 0) window.prepararBombo();
            document.getElementById('btn-play').disabled = true;
            document.getElementById('btn-pause').disabled = false;
            if(indiceActual === 0) sacarNumero();
            intervalo = setInterval(sacarNumero, velocidadS * 1000); 
        }

        window.pausar = () => { clearInterval(intervalo); intervalo = null; document.getElementById('btn-play').disabled = false; document.getElementById('btn-pause').disabled = true; }

        async function copiarAlPortapapeles(texto) {
            try {
                await navigator.clipboard.writeText(texto);
            } catch (err) {
                // Fallback si el navegador bloquea el clipboard
                const inputOculto = document.createElement("input");
                inputOculto.value = texto;
                document.body.appendChild(inputOculto);
                inputOculto.select();
                document.execCommand("copy");
                document.body.removeChild(inputOculto);
            }
        }

        function sacarNumero() {
            if(indiceActual >= bombo.length) { window.pausar(); return; }
            const n = bombo[indiceActual];
            numerosSalidos.push(n);
            document.getElementById('numero-visor').innerText = n;
            document.getElementById('contador-cartas').innerText = `SALIERON: ${indiceActual + 1} / 72`;
            
            const adorno = document.getElementById('input-adorno').value || "";
            const textoFinal = adorno + " *N√öMERO " + n + "* " + adorno;
            document.getElementById('txt-numero').value = textoFinal;
            
            copiarAlPortapapeles(textoFinal); // COPIADO AUTO
            
            if(audioActivado) {
                window.speechSynthesis.cancel();
                const m = new SpeechSynthesisUtterance("N√∫mero " + n);
                m.lang = 'es-MX'; window.speechSynthesis.speak(m);
            }

            const item = document.createElement('div');
            item.className = 'item-historial'; item.innerText = n;
            document.getElementById('lista-historial').prepend(item);
            indiceActual++;
        }

        window.abrirTableroFijo = () => {
            document.getElementById('modal-titulo').innerText = "TABLERO COMPLETO (1-72)";
            const grid = document.getElementById('modal-grid');
            grid.innerHTML = "";
            for (let i = 1; i <= 72; i++) {
                const item = document.createElement('div');
                item.className = "num-bola-modal " + (numerosSalidos.includes(i) ? "bola-salio" : "");
                item.innerText = i; grid.appendChild(item);
            }
            document.getElementById('modal-general').style.display = "flex";
        }

        window.abrirTableroOrden = () => {
            document.getElementById('modal-titulo').innerText = "ORDEN DE SALIDA";
            const grid = document.getElementById('modal-grid');
            grid.innerHTML = "";
            numerosSalidos.forEach(n => {
                const item = document.createElement('div');
                item.className = "num-bola-modal bola-orden-neon";
                item.innerText = n; grid.appendChild(item);
            });
            document.getElementById('modal-general').style.display = "flex";
        }

        window.generarLinkInternet = async () => {
            if(numerosSalidos.length === 0) return alert("Primero saca algunos n√∫meros");
            const btn = document.getElementById('btn-gen');
            const txtLink = document.getElementById('txt-link');
            
            btn.innerText = "‚è≥ SUBIENDO FOTO...";
            btn.disabled = true;

            // Preparamos la imagen (orden de salida)
            window.abrirTableroOrden();
            
            setTimeout(async () => {
                try {
                    const area = document.getElementById('captura-area');
                    const canvas = await html2canvas(area, { backgroundColor: "#000" });
                    const b64 = canvas.toDataURL("image/png").split(',')[1];
                    
                    const fd = new FormData();
                    fd.append("image", b64);

                    // API Key de ImgBB
                    const response = await fetch("https://api.imgbb.com/1/upload?key=8197992750e33433e5066318991a034f", {
                        method: "POST",
                        body: fd
                    });
                    
                    const resData = await response.json();
                    
                    if(resData.success) {
                        const linkDirecto = resData.data.url;
                        txtLink.value = linkDirecto;
                        await copiarAlPortapapeles(linkDirecto);
                        alert("‚úÖ LINK GENERADO Y COPIADO:\n" + linkDirecto);
                    } else {
                        alert("Error del servidor de im√°genes.");
                    }
                } catch (e) {
                    alert("Error al conectar con el servidor.");
                } finally {
                    btn.innerText = "üåê GENERAR Y COPIAR LINK";
                    btn.disabled = false;
                    window.cerrarModal();
                }
            }, 600);
        }

        window.toggleAudio = () => { audioActivado = !audioActivado; document.getElementById('btn-audio').innerText = audioActivado ? "üîä Audio" : "üîá Mudo"; }
        window.cerrarModal = () => { document.getElementById('modal-general').style.display = "none"; }
        window.reiniciar = () => { if(confirm("¬øDeseas reiniciar el sorteo?")) location.reload(); }
    </script>
</body>
</html>
