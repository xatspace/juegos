<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sorteador N√∫meros 1-72 ‚òÜ Shere</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* PROTECCI√ìN TOTAL */
        * { -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; outline: none; }
        
        body { 
            background: #000; color: #fff; font-family: 'Arial Black', sans-serif; 
            display: flex; flex-direction: column; align-items: center; 
            padding: 0; margin: 0; overflow: hidden;
        }

        /* Bloqueo de seguridad */
        #bloqueo-seguridad {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .login-box { background: #111; padding: 30px; border: 2px solid #39ff14; border-radius: 12px; text-align: center; box-shadow: 0 0 20px #39ff14; }
        .login-box h2 { color: #39ff14; margin-bottom: 20px; font-size: 18px; }
        .login-box input { 
            background: #000; border: 1px solid #333; color: #39ff14; 
            padding: 10px; border-radius: 5px; text-align: center; font-size: 16px; margin-bottom: 15px; outline: none;
        }
        .login-box button { 
            background: #39ff14; color: #000; border: none; padding: 10px 20px; 
            border-radius: 5px; font-weight: bold; cursor: pointer; text-transform: uppercase;
        }

        #contenido-protegido { display: none; width: 100%; height: 100%; }

        .layout-horizontal {
            display: grid;
            grid-template-columns: 450px 1fr; 
            width: 100vw; height: 100vh;
            gap: 10px; padding: 10px; box-sizing: border-box;
        }

        .loteria-section {
            display: flex; flex-direction: column; background: #0a0a0a;
            padding: 15px; border-radius: 12px; border: 1px solid #333;
            align-items: center; overflow-y: auto; box-sizing: border-box;
        }

        .visor-y-historial { display: flex; gap: 15px; justify-content: center; width: 100%; }

        .visor { 
            width: 170px; height: 170px; background-color: #000; 
            border: 5px solid #39ff14; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 25px rgba(57, 255, 20, 0.4);
        }
        
        .numero-grande { color: #39ff14; font-size: 80px; font-weight: 900; text-shadow: 0 0 20px #39ff14; }

        .controles { margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; width: 100%; }
        .loteria-section button { padding: 12px; font-size: 11px; font-weight: bold; border: none; border-radius: 6px; cursor: pointer; text-transform: uppercase; transition: 0.2s; }
        
        .btn-ver-tablero { background: #00bcff; color: #000; width: 100%; margin-bottom: 8px; } 
        .btn-ver-orden { background: #ff00ff; color: #fff; width: 100%; margin-top: 5px; } 

        .config-extra { width: 100%; margin-top: 10px; background: #1a1a1a; padding: 10px; border-radius: 8px; border: 1px solid #444; box-sizing: border-box; }
        .input-adorno { background: #000; border: 1px solid #39ff14; color: #fff; padding: 8px; border-radius: 4px; text-align: center; width: 100%; box-sizing: border-box; }

        .historial-container { display: flex; flex-direction: column; width: 140px; }
        .historial { height: 210px; background: #111; border: 2px solid #333; border-radius: 10px; padding: 5px; overflow-y: auto; }
        .item-historial { display: flex; align-items: center; justify-content: center; background: #222; padding: 8px; border-radius: 50%; margin-bottom: 8px; border: 1px solid #39ff14; font-size: 14px; width: 35px; height: 35px; margin: 5px auto; color: #39ff14; font-weight: bold; }

        .chat-tools { margin-top: 10px; width: 100%; background: #222; padding: 10px; border-radius: 8px; border: 1px solid #39ff14; box-sizing: border-box; }
        #txt-copiar { background: #000; border: 1px solid #444; color: #39ff14; padding: 10px; border-radius: 4px; font-size: 14px; text-align: center; width: 100%; box-sizing: border-box; margin-bottom: 8px; outline: none; }

        .btn-link { background: #ffffff; color: #000; width: 100%; margin-top: 10px; border: 2px solid #39ff14; }
        .btn-captura { background: #ffeb3b; color: #000; width: 100%; margin-top: 5px; font-size: 10px !important; }

        /* MODALES */
        #modal-general { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:2000; justify-content:center; align-items:center; }
        .modal-contenedor-dinamico { background:#000; border:2px solid #39ff14; border-radius:10px; padding:20px; position:relative; width: 90%; max-width: 800px; }
        
        #captura-area { background: #000; padding: 10px; }
        .grid-numeros { display:grid; grid-template-columns: repeat(12, 1fr); gap: 5px; padding: 10px; }
        .num-bola-modal { border-radius: 50%; display: flex; align-items: center; justify-content: center; aspect-ratio: 1/1; font-weight: bold; font-size: 14px; }
        .bola-falta { border: 1px solid #39ff14; color: #39ff14; }
        .bola-salio { border: 1px solid #ff0000; color: #fff; background: #ff0000; }
        .bola-orden-neon { border: 1px solid #39ff14; color: #39ff14; box-shadow: 0 0 8px #39ff14; }

        @media (max-width: 700px) { .grid-numeros { grid-template-columns: repeat(8, 1fr); } }
    </style>
</head>
<body oncontextmenu="return false">

    <div id="bloqueo-seguridad">
        <div class="login-box">
            <h2>SORTEADOR N√öMEROS (1-72)</h2>
            <input type="password" id="pass-lm" placeholder="PIN DE ACCESO">
            <br>
            <button id="btn-entrar">ENTRAR</button>
        </div>
    </div>

    <div id="contenido-protegido">
        <div class="layout-horizontal">
            <div class="loteria-section">
                
                <button class="btn-ver-tablero" onclick="window.abrirTableroFijo()">üìä VER TABLERO (1-72)</button>

                <div class="visor-y-historial">
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <div class="visor" id="visor">
                            <div class="numero-grande" id="numero-visor">--</div>
                        </div>
                        <p id="contador-cartas" style="color:#ffeb3b; font-size: 12px; margin: 10px 0;">SALIERON: 0 / 72</p>
                    </div>

                    <div class="historial-container">
                        <div class="historial" id="lista-historial"></div>
                        <button class="btn-ver-orden" onclick="window.abrirTableroOrden()">üìã VER ORDEN</button>
                    </div>
                </div>

                <div class="controles">
                    <button style="background:#39ff14; color:#000;" id="btn-play" onclick="window.comenzar()">‚ñ∂ Play</button>
                    <button style="background:#ffeb3b; color:#000;" id="btn-pause" onclick="window.pausar()" disabled>‚è∏ Pausa</button>
                    <button style="background:#ff0000; color:#fff;" onclick="window.reiniciar()">üîÑ Reset</button>
                    <button id="btn-audio" style="background:#555; color:#fff;" onclick="window.toggleAudio()">üîä Audio</button>
                </div>

                <div style="width:100%; margin-top:10px; text-align:center;">
                    <label style="font-size:11px; color:#aaa;">Velocidad: <span id="val-velocidad">4.0</span>s</label>
                    <input type="range" min="2" max="8" step="0.5" value="4" style="width:100%; cursor:pointer;" oninput="window.cambiarVelocidad(this.value)">
                </div>

                <div class="config-extra">
                    <label style="font-size:11px; color:#39ff14;">Adorno:</label>
                    <input type="text" id="input-adorno" class="input-adorno" value="‚òÜ" maxlength="10">
                </div>

                <div class="chat-tools">
                    <input type="text" id="txt-copiar" readonly placeholder="Esperando n√∫mero o link...">
                    <button style="width:100%; background:#39ff14; color:#000; font-weight:bold;" onclick="window.copiarManual()">COPIAR TEXTO / LINK</button>
                </div>

                <button class="btn-link" id="btn-generar-link" onclick="window.generarLinkInternet()">üåê GENERAR LINK DE TABLERO</button>
                <button class="btn-captura" onclick="window.tomarCaptura()">üì∏ SOLO DESCARGAR IMAGEN</button>
            </div>

            <div class="chat-section">
                <iframe id="chat-iframe" src="https://xat.com/embed/chat.php#id=220526680&gn=RINCONCITO_MAGICO_MUSICAL" frameborder="0" scrolling="no"></iframe>
            </div>
        </div>
    </div>

    <div id="modal-general">
        <div class="modal-contenedor-dinamico">
            <span onclick="window.cerrarModal()" style="position:absolute; top:0px; right:15px; color:#ff4444; font-size:40px; cursor:pointer; z-index:100;">&times;</span>
            <div id="captura-area">
                <h2 id="modal-titulo" style="color: #39ff14; text-align: center; font-size: 16px; margin-bottom: 10px;">TABLERO</h2>
                <div id="modal-grid" class="grid-numeros"></div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('btn-entrar').onclick = () => {
            if(document.getElementById('pass-lm').value === "shere2026") {
                document.getElementById('bloqueo-seguridad').style.display = 'none';
                document.getElementById('contenido-protegido').style.display = 'block';
            } else { alert("PIN INCORRECTO"); }
        };

        let bombo = [], indiceActual = 0, intervalo = null, numerosSalidos = [], audioActivado = true, velocidadS = 4;

        window.prepararBombo = () => {
            bombo = Array.from({length: 72}, (_, i) => i + 1);
            bombo.sort(() => Math.random() - 0.5);
        }

        window.cambiarVelocidad = (val) => {
            velocidadS = val;
            document.getElementById('val-velocidad').innerText = val;
            if (intervalo) { window.pausar(); window.comenzar(); }
        }

        function cantarNumero(num) {
            if (!audioActivado) return;
            window.speechSynthesis.cancel();
            const mensaje = new SpeechSynthesisUtterance("N√∫mero " + num);
            mensaje.lang = 'es-MX';
            window.speechSynthesis.speak(mensaje);
        }

        window.comenzar = () => {
            if (bombo.length === 0) window.prepararBombo();
            document.getElementById('btn-play').disabled = true;
            document.getElementById('btn-pause').disabled = false;
            if(indiceActual === 0) sacarNumero();
            intervalo = setInterval(sacarNumero, velocidadS * 1000); 
        }

        window.pausar = () => {
            clearInterval(intervalo);
            intervalo = null;
            document.getElementById('btn-play').disabled = false;
            document.getElementById('btn-pause').disabled = true;
        }

        function sacarNumero() {
            if(indiceActual >= bombo.length) { window.pausar(); return; }
            const n = bombo[indiceActual];
            numerosSalidos.push(n);
            document.getElementById('numero-visor').innerText = n;
            document.getElementById('contador-cartas').innerText = `SALIERON: ${indiceActual + 1} / 72`;
            
            const adorno = document.getElementById('input-adorno').value || "";
            document.getElementById('txt-copiar').value = adorno + " *N√öMERO " + n + "* " + adorno;
            
            cantarNumero(n);

            const item = document.createElement('div');
            item.className = 'item-historial';
            item.innerText = n;
            document.getElementById('lista-historial').prepend(item);
            indiceActual++;
        }

        window.copiarManual = () => {
            const input = document.getElementById('txt-copiar');
            input.select();
            navigator.clipboard.writeText(input.value);
        }

        window.abrirTableroFijo = () => {
            document.getElementById('modal-titulo').innerText = "TABLERO FIJO (1-72)";
            const grid = document.getElementById('modal-grid');
            grid.innerHTML = "";
            for (let i = 1; i <= 72; i++) {
                const item = document.createElement('div');
                item.className = "num-bola-modal " + (numerosSalidos.includes(i) ? "bola-salio" : "bola-falta");
                item.innerText = i;
                grid.appendChild(item);
            }
            document.getElementById('modal-general').style.display = "flex";
        }

        window.abrirTableroOrden = () => {
            document.getElementById('modal-titulo').innerText = "ORDEN DE SALIDA";
            const grid = document.getElementById('modal-grid');
            grid.innerHTML = "";
            numerosSalidos.forEach(n => {
                const item = document.createElement('div');
                item.className = "num-bola-modal bola-orden-neon";
                item.innerText = n;
                grid.appendChild(item);
            });
            document.getElementById('modal-general').style.display = "flex";
        }

        window.generarLinkInternet = async () => {
            if(numerosSalidos.length === 0) return alert("Sorteo vac√≠o");
            const btn = document.getElementById('btn-generar-link');
            btn.innerText = "‚è≥ SUBIENDO...";
            window.abrirTableroOrden();
            
            setTimeout(async () => {
                const area = document.getElementById('captura-area');
                const canvas = await html2canvas(area, { backgroundColor: "#000" });
                const base64Image = canvas.toDataURL("image/png").split(',')[1];

                const formData = new FormData();
                formData.append("image", base64Image);

                try {
                    const response = await fetch("https://api.imgbb.com/1/upload?key=8197992750e33433e5066318991a034f", {
                        method: "POST",
                        body: formData
                    });
                    const data = await response.json();
                    if(data.success) {
                        document.getElementById('txt-copiar').value = data.data.url_viewer;
                        alert("‚úÖ LINK GENERADO EN EL CUADRO DE COPIAR");
                    }
                } catch (err) { alert("Error"); }
                btn.innerText = "üåê GENERAR LINK DE TABLERO";
                window.cerrarModal();
            }, 500);
        }

        window.tomarCaptura = async () => {
            window.abrirTableroOrden();
            setTimeout(async () => {
                const area = document.getElementById('captura-area');
                const canvas = await html2canvas(area, { backgroundColor: "#000" });
                const link = document.createElement('a');
                link.download = 'tablero.png';
                link.href = canvas.toDataURL("image/png");
                link.click();
            }, 500);
        }

        window.toggleAudio = () => {
            audioActivado = !audioActivado;
            document.getElementById('btn-audio').innerText = audioActivado ? "üîä Audio" : "üîá Mudo";
        }

        window.cerrarModal = () => { document.getElementById('modal-general').style.display = "none"; }

        window.reiniciar = () => {
            if(confirm("¬øReiniciar?")) location.reload();
        }
    </script>
</body>
</html>