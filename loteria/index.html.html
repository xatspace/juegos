<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loter칤a Mexicana</title>
    <style>
        body { 
            background: #000; 
            color: #fff; 
            font-family: 'Arial Black', sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 10px; 
            margin: 0;
        }
        .neon-title { 
            color: #00e5ff; 
            text-shadow: 0 0 15px #00e5ff; 
            font-size: clamp(22px, 6vw, 32px); 
            text-transform: uppercase; 
            margin: 20px 0; 
        }
        
        #tablero { 
            display: grid; 
            grid-template-columns: repeat(9, 1fr); 
            gap: 10px; 
            width: 98%; 
            max-width: 1100px; 
            background: #111; 
            border: 3px solid #00e5ff; 
            padding: 15px; 
            border-radius: 12px; 
            box-sizing: border-box;
        }

        .celda { 
            aspect-ratio: 2 / 3.3; 
            border: 2px solid #333; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: space-between; 
            cursor: pointer; 
            border-radius: 8px; 
            background: #fff; 
            transition: 0.2s; 
            overflow: hidden;
            padding: 5px;
            box-sizing: border-box;
        }
        
        .celda:hover { border-color: #00e5ff; transform: scale(1.05); z-index: 10; }
        
        .img-carta {
            width: 100%;
            height: 75%;
            object-fit: contain;
            pointer-events: none;
        }

        /* NOMBRE M츼S GRANDE */
        .n-user { 
            width: 100%;
            font-size: clamp(10px, 2.5vw, 15px); /* Aumentado */
            font-weight: 900; 
            color: #000; 
            text-transform: uppercase; 
            text-align: center;
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis;
            padding: 4px 0;
        }
        
        .ocupado { 
            background: #ffeb3b !important; 
            border: 3px solid #d32f2f;
            cursor: not-allowed; 
        }
        .ocupado .n-user { color: #d32f2f; font-size: clamp(11px, 2.8vw, 16px); }
        .ocupado .img-carta { filter: grayscale(100%) opacity(0.3); }

        .btn-reset { margin-top: 40px; background: #000; color: #444; border: 1px dashed #444; padding: 10px 20px; cursor: pointer; border-radius: 5px; font-size: 11px; }

        @media (max-width: 850px) { #tablero { grid-template-columns: repeat(5, 1fr); } }
        @media (max-width: 500px) { #tablero { grid-template-columns: repeat(3, 1fr); } }
    </style>
</head>
<body>

    <div class="neon-title">LOTER칈A MEXICANA</div>
    <div id="tablero"></div>

    <button class="btn-reset" onclick="resetJuego()">游댃 REINICIAR TODO</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, get, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const app = initializeApp({ databaseURL: "https://invertidos-default-rtdb.firebaseio.com/" });
        const db = getDatabase(app);
        const refSala = ref(db, 'loteria_v_pro_juego');
        const refIPs = ref(db, 'loteria_v_pro_ips');
        const claveAdmin = "juegos2026"; 

        const cartas = [
            "El Gallo", "El Diablito", "La Dama", "El Catr칤n", "El Paraguas", "La Sirena", "La Escalera", "La Botella", "El Barril", "El 츼rbol",
            "El Mel칩n", "El Valiente", "El Gorrito", "La Muerte", "La Pera", "La Bandera", "El Bandol칩n", "El Violoncello", "La Garza", "El P치jaro",
            "La Mano", "La Bota", "La Luna", "El Cotorro", "El Borracho", "El Negrito", "El Coraz칩n", "La Sand칤a", "El Tambor", "El Camar칩n",
            "Las Jaras", "El M칰sico", "La Ara침a", "El Soldado", "La Estrella", "El Cazo", "El Mundo", "El Apache", "El Nopal", "El Alacr치n",
            "La Rosa", "La Calavera", "La Campana", "El Cantarito", "El Venado", "El Sol", "La Corona", "La Chalupa", "El Pino", "El Pescado",
            "La Palma", "La Maceta", "El Arpa", "La Rana"
        ];

        async function obtenerIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip.replace(/\./g, '_');
            } catch (e) { return "user_" + Math.floor(Math.random() * 9999); }
        }

        function render(datos = {}) {
            const tab = document.getElementById('tablero');
            tab.innerHTML = "";
            cartas.forEach((c, index) => {
                const id = index + 1;
                const nick = datos[c] ? datos[c].nombre : null;
                const div = document.createElement('div');
                div.className = `celda ${nick ? 'ocupado' : ''}`;
                div.onclick = () => { if(!nick) anotar(c); };
                
                // NUEVO LINK PROBADO Y FUNCIONAL
                const imgUrl = `https://www.donnaipe.com/wp-content/uploads/2016/11/${id}.png`;

                div.innerHTML = `
                    <img src="${imgUrl}" class="img-carta" alt="${c}" onerror="this.src='https://via.placeholder.com/150x220?text=${id}'">
                    <span class="n-user">${nick ? nick : c}</span>
                `;
                tab.appendChild(div);
            });
        }

        window.anotar = async (c) => {
            const miIP = await obtenerIP();
            const checkIP = await get(ref(db, 'loteria_v_pro_ips/' + miIP));
            if (checkIP.exists()) return alert("游뛂 Ya elegiste una carta.");
            
            const n = prompt("Carta: " + c + "\nIngresa tu Nick:");
            if (n && n.trim() !== "") {
                await set(ref(db, 'loteria_v_pro_juego/' + c), { nombre: n.trim().toUpperCase() });
                await set(ref(db, 'loteria_v_pro_ips/' + miIP), true);
            }
        };

        window.resetJuego = async () => {
            if (prompt("Clave:") === claveAdmin) {
                await remove(refSala);
                await remove(refIPs);
            }
        };

        onValue(refSala, (snap) => render(snap.val() || {}));
    </script>
</body>
</html>
